generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model blocks {
  id           String     @id @default(uuid()) @db.Uuid
  workspace_id String     @db.Uuid
  parent_id    String?    @db.Uuid
  type         String
  properties   Json       @default("{}")
  sort_order   Int        @default(0)
  created_at   DateTime   @default(now()) @db.Timestamptz(6)
  updated_at   DateTime   @default(now()) @db.Timestamptz(6)
  blocks       blocks?    @relation("blocksToblocks", fields: [parent_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  other_blocks blocks[]   @relation("blocksToblocks")
  workspaces   workspaces @relation(fields: [workspace_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([parent_id], map: "idx_blocks_parent_id")
  @@index([properties], map: "idx_blocks_properties_gin", type: Gin)
  @@index([workspace_id], map: "idx_blocks_workspace_id")

  @@map("blocks")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model users {
  id                String              @id @default(uuid()) @db.Uuid
  email             String              @unique
  password_hash     String
  name              String?
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  workspace_members workspace_members[]
  workspaces        workspaces[]
  @@map("users")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model workspace_members {
  user_id      String     @db.Uuid
  workspace_id String     @db.Uuid
  role         String
  joined_at    DateTime   @default(now()) @db.Timestamptz(6)
  users        users      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  workspaces   workspaces @relation(fields: [workspace_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([user_id, workspace_id])
  @@index([workspace_id], map: "idx_members_workspace_id")
  @@map("workspace_members")
}

model workspaces {
  id                String              @id @default(uuid()) @db.Uuid
  name              String
  owner_id          String              @db.Uuid
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  blocks            blocks[]
  workspace_members workspace_members[]
  users             users               @relation(fields: [owner_id], references: [id], onUpdate: NoAction)
  @@map("workspaces")
}

model invalid_tokens {
  jti String @id
  expires_at DateTime @db.Timestamptz(3)

  @@map("invalid_tokens")
}